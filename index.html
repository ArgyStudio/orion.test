<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Empezar a Jugar</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <main class="card" role="dialog" aria-labelledby="heroTitle age-title" aria-describedby="age-desc">
    <!-- TITULO PRINCIPAL DIN√ÅMICO (muestra nombre sacado de la √∫ltima parte de la URL) -->
    <h2 id="heroTitle" class="hero-title" aria-live="polite">¬°Te saluda Wonbet<span id="username">Jugador</span>!</h2>

    <!-- Subtitulo / T√≠tulo de la card -->

    <p id="age-desc" class="lead">Sos mayor de <strong>18+</strong> a√±os?</p>

    <!-- BLOQUE: JUGAR -->
    <div class="cta-wrap" aria-label="Acci√≥n jugar">
      <a href="#" class="btn" id="playBtn" role="button" aria-pressed="false">JUGAR</a>
    </div>

    <div class="desc" aria-hidden="false">
      <p><strong>Haz click aqui para Jugar</strong></p>
    </div>

    <div class="notice" aria-hidden="false">
      <div class="box">
        <p class="title">üé∞ JUGAR</p>
        <div class="leftbar">
          <p class="content">
            Si ya tenes Usuario pod√©s hacer click en este bot√≥n para <strong>empezar a Jugar.</strong><br>
            <span style="display:inline-block; margin-top:6px; font-size:12px; opacity:0.85;">
              No compartas tus datos con nadie.
            </span>
          </p>
        </div>
      </div>
    </div>

    <!-- separador -->
    <hr class="sep">

    <!-- BLOQUE ADICIONAL: CAJA -->
    <div class="cta-wrap" aria-label="Acci√≥n caja" style="margin-top:6px;">
      <a href="#" class="btn" id="cajaBtn" role="button" aria-pressed="false">CAJA</a>
    </div>

    <div class="desc" aria-hidden="false" style="margin-top:10px;">
      <p style="font-weight:700;">
        Hace click ac√° para <strong>cargas y retiros</strong>
      </p>
    </div>

    <div class="notice" aria-hidden="false" style="margin-top:10px;">
      <div class="box">
        <p class="title">üèß CAJA</p>
        <div class="leftbar">
          <p class="content">
            Para comunicarte con un cajero y hacer una <strong>recarga/retiro</strong> o cualquier otro tipo de duda sobre tu usuario, esta es la opci√≥n a elegir.
          </p>
        </div>
      </div>
    </div>

  </main>

<script>

  let name;

/* ---------- Extrae token (preferencia: query) y lo formatea ---------- */
(function () {
  // intenta primero sacar lo que viene despu√©s del "?"
  const search = window.location.search || '';
  let rawResult = '';

  if (search.length > 1) {
    // quitamos el "?" y cualquier hash
    const raw = search.slice(1).split('#')[0];

    if (raw.includes('=')) {
      // caso standard key=value: tomamos el primer par√°metro disponible
      const params = new URLSearchParams(raw);
      const firstKey = Array.from(params.keys())[0];
      const firstValue = params.get(firstKey);
      rawResult = (firstValue !== null && firstValue !== '') ? firstValue : firstKey;
    } else {
      // caso token suelto: ?Rmati1aho
      rawResult = raw.split('&')[0];
    }
  } else {
    // si no hay query, usamos el √∫ltimo segmento del pathname
    rawResult = window.location.pathname.split('/').filter(Boolean).pop() || '';
  }

  // fallback si qued√≥ vac√≠o
  if (!rawResult) rawResult = 'Jugador';

  // decodificar y limpiar: + -> espacio, reemplazar -/_ por espacios, trim
  const decoded = decodeURIComponent(rawResult.replace(/\+/g, ' ')).replace(/[-_]+/g, ' ').trim();

  // capitalizar cada palabra y asignar a la variable `name` (ya declarada arriba)
  name = decoded
    .split(/\s+/)
    .map(s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase())
    .join(' ');

  // setea en el span si existe
  const el = document.getElementById('username');
  if (el) el.textContent = name || 'Jugador';
})();



  async function  postBack(url, payload) {
    const res = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    return await res.json();   
  }

  /* ---------- Handlers de botones y accesibilidad ---------- */
  document.getElementById('playBtn').addEventListener('click', function (e) {
    
    window.open("https://wonbet.lat/", "_blank", "noopener,noreferrer");
    
    // ejemplo: redirigir o ejecutar funci√≥n real
    // e.preventDefault(); // descoment√° si us√°s solo demo
    console.log('JUGAR -> clicked');
    // window.location.href = '/jugar'; // ejemplo real
  });

  document.getElementById('cajaBtn').addEventListener('click', function (e) {
    console.log('CAJA -> clicked');
      const Usuario = name;
      console.log(`Usuario: ${Usuario}`);

      const URL = "https://xneli80uz8.execute-api.us-east-2.amazonaws.com/default/orion-l"

      if (!Usuario || Usuario.trim()===""){
        window.alert("‚ö†Ô∏èError: No se encontro tu usuario\n üõëPor favor ingresar desde el link que se te envio antes");
      } else {
        const payload = { Usuario : Usuario}
        postBack(URL, payload)
        console.log("Datos enviados al servidor");
        console.log (payload);
      }

      
    // window.location.href = '/caja'; // ejemplo real
  });

  // teclas r√°pidas: Enter dispara JUGAR
  window.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      document.getElementById('playBtn').click();
    } else if (e.key === 'Escape') {
      // opcional: podr√≠as cerrar el modal si lo quer√©s implementar
    }
  });
</script>

</body>
</html>
